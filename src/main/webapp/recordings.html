<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
		<link rel="icon" href="img/mindhash.ico" type="image/x-icon">
		<title>Recordings list | MindHash</title>
		<link type="text/css" rel="stylesheet" href="css/common-style.css">
	</head>
	<body>
		<header class="header box-layout center-v">
			<div class="logo"></div>
			<a href="recordings.html" class="home-link"></a>
			<div class="box-col"><a href="profile.html" class="avatar"></a></div>
		</header>
		<script src="js/switch-mode.js"></script>
		
		<section class="wrapper mt-64">
			<ul class="recordings-list">
				<li>Recordings</li>
				<li id="title" class="box-layout">
					<div class="box-col">#</div>
					<div class="box-col">Start time</div>
					<div class="box-col">End time</div>
					<div class="box-col">Resolution</div>
					<div class="box-col">Frame rate</div>
				</li>
			</ul>
		</section>
		<script>
			var token = sessionStorage.getItem("sessionToken");
			if (token != null) {
				let xmlhttpaccess = new XMLHttpRequest();
				xmlhttp.onreadystatechange = function() {
					if (this.readyState == 4 && this.status == 200) {
						var response = this.responseText,
							recordings = JSON.parse(response),
							htmlStr = "";
						for(var recording of recordings) {
							var id = recording.recordingID;
							htmlStr += '<li>'
											+ '<a href="dashboard.html?id=' + id + '&date='+ recording.date + '&lat=' + recording.latitude + '&lon=' + recording.longitude + '" class="box-layout">'
											+ '<div class="box-col">Recording' + (id > 9 ? id : ('0' + id) + "_" + recording.date) + '</div>'
											+ '<div class="box-col">' + recording.startTime + '</div>'
											+ '<div class="box-col">' + recording.endTime + '</div>'
											+ '<div class="box-col">' + recording.resolution + '</div>'
											+ '<div class="box-col">' + recording.frameRate + '</div>'
											+ '</a>'
										+ '</li>'
						}
						document.querySelector("#title").insertAdjacentHTML("afterend", htmlStr);
					} else if (this.readyState == 4 && this.status == 511) {
						location.href = "login.html";
					}
				}
				xmlhttp.open("GET", "/mindhash/rest/recordings", true);
				xmlhttp.setRequestHeader("Accept", "application/json");
				xmlhttp.setRequestHeader("Authorization", token);
				xmlhttp.send();
			} else {
				sessionStorage.removeItem("sessionToken");
				location.href = "login.html";
			}
		</script>
	</body>
</html>
